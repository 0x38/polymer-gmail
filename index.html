<!-- Author: Eric Bidelman <@ebidel> -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- Fallback for manifest.json add to homescreen (Chrome Android) -->
  <meta name="mobile-web-app-capable" content="yes">

  <meta name="apple-mobile-web-app-status-bar-style" content="#e51c23">
  <meta name="theme-color" content="#e51c23">
  <meta name="msapplication-TileColor" content="#e51c23">
  <meta name="msapplication-tap-highlight" content="no">
  <title>Polymer Mail</title>

  <link rel="manifest" href="manifest.json">

  <!-- Note: webcomponent.js is only needed in non-Chrome 36 browsers. Included here for portability. -->
  <script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
  <!-- <link rel="import" href="vulcanized.html"> -->
  <link rel="import" href="elements.html">
  <link rel="stylesheet" href="app.css">
  <link rel="import" href="appstyles_sd.html">

  <link rel="icon" sizes="192x192" href="images/gmail.png">
</head>
<!-- <body class="fullbleed" unresolved -->
<body class="fullbleed">

<!-- <core-style id="navheaderstyle">
  #navheader::after {
    /* causes console warning for incorrect mimetype */
    background-image: url({{coverImg}});
  }
</core-style>
 -->
<template id="t" is="dom-bind">

<!-- <core-style ref="navheaderstyle"></core-style> -->
<!-- <core-style ref="labelcolors"></core-style> -->

<div id="loginscreen" class="layout vertical center-center fit" show$="{{!isAuthenticated}}">
  <google-signin width="wide" height="tall"
      clientId="229000986068-hld1d9ovioamaaur218vg3jg5dgvf2a2.apps.googleusercontent.com"
      scopes="profile email https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/gmail.modify"
      on-google-signin-success="onSigninSuccess"
      on-google-signin-failure="onSigninFailure"></google-signin>
</div>

<material-search id="search" narrow="{{narrow}}"
                 previousSearches="{{previousSearches}}" class="fit"></material-search>

<paper-drawer-panel id="drawerPanel" narrow="{{narrow}}">

  <paper-header-panel mode="scroll" drawer>
    <paper-toolbar id="navheader" class="tall">
      <!-- <iron-image src="{{user.cover}}" sizing="cover" preload fade
                  style="width:400px; height:400px; background-color:#c41411;">
      </iron-image> -->
      <img class="middle profile" src="{{user.profile}}" hidden="{{!user.profile}}">
      <div class="bottom layout vertical">
        <span>{{user.name}}</span>
        <span>{{user.email}}</span>
      </div>
    </paper-toolbar>
    <paper-menu selectable="paper-icon-item" on-paper-select="menuSelect">
      <paper-icon-item role="menuitem">
        <iron-icon icon="inbox" item-icon></iron-icon>Inbox
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="social:people" item-icon></iron-icon>Social
      </paper-icon-item>

      <div class="separator">All labels</div>
      <paper-icon-item role="menuitem">
        <iron-icon icon="star" item-icon></iron-icon>Starred
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="send" item-icon></iron-icon>Sent
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="icons:drafts" item-icon></iron-icon>Drafts
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="mail" item-icon></iron-icon>All Mail
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="report" item-icon></iron-icon>Spam
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="delete" item-icon></iron-icon>Trash
      </paper-icon-item>
      <template is="dom-repeat" items="{{labels}}">
        <paper-item role="menuitem" class$="{{item.color}}">
          <iron-icon icon="label"></iron-icon><span>{{item.name}}</span>
        </paper-item>
      </template>
    </paper-menu>
  </paper-header-panel>

  <paper-scroll-header-panel id="scrollheader" main
      keep-condensed-header condenses="{{!narrow}}" fixed="{{narrow}}"
      on-trackstart="onRefreshStart"
      on-tracky="onMainAreaTrack"
      on-trackend="onRefreshUp">

    <paper-toolbar id="mainheader" class$="[[headerClass]]">
      <paper-icon-button icon="arrow-back" class="selected-item" on-tap="deselectAll"></paper-icon-button>

      <paper-icon-button id="navicon" icon="menu" paper-drawer-toggle></paper-icon-button>
      <div class="flex"></div>
      <span class="bottom indent title">{{headerTitle}}</span>
      <paper-icon-button icon="search" class="fade-on-drawer-open" on-tap="toggleSearch"></paper-icon-button>

      <paper-icon-button icon="archive" class="selected-item" on-tap="archiveAll"></paper-icon-button>
      <paper-icon-button icon="delete" class="selected-item"></paper-icon-button>
      <paper-icon-button icon="mail" class="selected-item"></paper-icon-button>

      <!-- <paper-menu-button class="selected-item" class="layout horizontal">
        <paper-icon-button icon="more-vert"></paper-icon-button>
        <paper-dropdown class="dropdown" halign="right">
          <paper-item>Move to</paper-item>
          <paper-item>Change labels</paper-item>
          <paper-item>Add star</paper-item>
          <paper-item>Mark not important</paper-item>
          <paper-item>Mute</paper-item>
          <paper-item>Report spam</paper-item>
          <paper-item>Report phishing</paper-item>
        </paper-dropdown>
      </paper-menu-button> -->

      <div id="refresh" class="bottom fit layout horizontal center-center"
           on-transitionend="onRefreshTransitionEnd">
        <div>
          <!-- <paper-material class="fit" elevation="2" animated></paper-material> -->
          <paper-spinner id="refreshspinner"></paper-spinner>
        </div>
      </div>

    </paper-toolbar>
    <div content on-thread-archive="onThreadArchive">

      <template is="dom-if" if="{{_computeShowSpinner(threads, isAuthenticated)}}">
        <div class="layout vertical center-center" style="height:100%">
          <paper-spinner active></paper-spinner>
        </div>
      </template>

      <!-- TODO: don't pass all messages, users, labels into mail-thread -->
      <iron-selector id="threadlist" multi
                     selected-attribute="selected"
                     selected-items="{{selectedThreads}}"
                     on-iron-select="_onThreadSelectChange"
                     on-iron-deselect="_onThreadSelectChange">
        <template is="dom-repeat" items="[[threads]]">
          <mail-thread messages="[[item.messages]]"
                       labels="[[labelMap]]" users="[[users]]"
                       narrow="[[narrow]]"
                       touch-action="[[touchAction]]"></mail-thread>
        </template>
      </iron-selector>

     </div>
  </paper-scroll-header-panel>

</paper-drawer-panel>

<paper-toast id="toast" duration="10000" swipe-disabled
             text="{{toastMessage}}" opened="{{toastOpened}}"
             on-paper-overlay-open="onToastOpenClose">
  <div on-tap="undoAll">Undo</div>
</paper-toast>

<paper-fab id="fab" icon="create" on-tap="newMail"></paper-fab>

<!-- Cache data requests. -->
<!--<iron-localstorage name="polymer-mail-user" value="{{user}}"></iron-localstorage>-->
<!--<iron-localstorage name="polymer-mail-labels" value="{{labels}}"></iron-localstorage>-->
<!--<iron-localstorage name="polymer-mail-threads" value="{{threads}}"></iron-localstorage>-->
<!--<iron-localstorage name="polymer-mail-users" value="{{users}}"></iron-localstorage>-->

</template>

<script src="app.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-56540783-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
